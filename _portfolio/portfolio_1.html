---
title: "Particle Tracking Velocimetry (PTV) using K-Nearest Neighbors (KNN)"
excerpt: "A gentle, informal implementation of PTV using KNN technique using negligible mathematical equations and a pinch of Python (code)<br>
<br>
<img src='/images/KNN_/teaser.jpg'>"
collection: portfolio
---
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Code Block with Auto Syntax Highlighting</title>

    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
	
	<style> <! .... Style video container ....>
	        /* Centering the video */
        .video-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 50%;
            padding: 20px;
        }

	video {
            display: block; /* Ensures no extra space */
            margin: auto; /* Centers horizontally */
            width: 70%; /* Adjust as needed */
            max-width: 500px;
            border-radius: 10px;
        }

	/* Responsive Design */
        @media (max-width: 500px) {
            video {
                width: 90%;
            }
        }
	</style>

	
    <style> <! .... for the image containers ....>

	/* Figure wrapper to center everything */
        .image-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center; /* Centers the figure */
            justify-content: center;
            text-align: center; /* Ensures caption is centered */
            margin-bottom: 10px; /* Adds spacing between groups */
        }
		
        /* Container for images */
        .image-container {
            display: flex; /* Align images in a row */
            justify-content: center; /* Center images */
            align-items: center; /* Align images vertically */
            flex-wrap: wrap;  Allows wrapping for responsiveness */
            width: 100%; /* Adjusts width */
            max-width: 900px; /* Prevents excessive stretching */
            border: 1px solid black; /* Border around the images */
            padding: 1px; /* Space inside the border */
            box-sizing: border-box; /* Ensures padding doesn’t increase size */
            margin: 1px auto; /* Centers the container */
            gap: 5px; /* Adds spacing between images */
        }
		
        /* Single image layout */
        .single-image .image-container img {
            width: 40%;
			margin-bottom: -1px;
			/* Full width for single image */
        }
        /* Styling for images */
        .two-columns .image-container img {
            width:49%; /* Two-column layout by default */
            margin-bottom: -1px;
        }

        /* Three-column layout */
        .three-columns .image-container img {
            width: 32%; /* Three images per row */
			margin-bottom: -1px;
        }
		/* Caption styling */
        .image-caption {
            font-style: italic;
            color: black;
            margin-top: 10px; /* Adds spacing above the caption */
            font-size: 0.9em;
        }

        /* Responsive: Stack images on smaller screens */
        @media (max-width: 600px) {
			.image-container{
                flex-direction: column; /* Stack images on smaller screens */
                width:100%; /* Adjust for smaller screens */
            }
            .image-container img {
                width: 100%; /* Full width when stacked */
            }
        }
	</style>

</head>


<body>
<p style="text-align:justify;">
For soft, condensed matter physics, tracking particulate matter in flows are a cornerstone for understanding fluid behavior. Whether it understand fluid-solid interactions or whether it for understanding the fluid flow itself: -- where the particles in the fluid act as tracers. Thus, if we suspend tiny, lightweight particles in any fluid and track their motion, we can infer the flow behavior of the fluid itself, even if the fluid is transparent … sounds cool right!!
</p>
	
<p style="text-align:justify;">
If you have the liberty to dump larger concentration of particles into the fluid, then the fluid flow redistributes the particles in different regions of the fluid based on their velocity. Thus, by cross correlating the changes in positions of a bunch of these particles we can infer their speeds (for the curious ones.… this correlations process resembles convolution kernels a lot!!!.) This method is now popularly known as Particle Image Velocimetry (PIV).
</p>

<p style="text-align:justify;">
PIV is extremely good for cases where the particles obediently follow the fluid flow without any active involvement. Thus, to measure the fluid flow, we can map the motion of an ensemble of these particles without the need for tracking individual particle.
</p>

<p style="text-align:justify;">
Many a time, the particles are actively involved and modify the fluid dynamics through hydrodynamic perturbations. In such cases, measuring the motion of nearly every particle, becomes very important. To do so, we use another very interesting technique called as the Particle Tracking Velocimetry (PTV). <br>
PTV is performed by taking multiple snapshots in quick succession of a moving particle and correlating their position across these multiple snapshots. So, how does this work?? 
</p>	
	
<!........ Figure 1 .......>
<figure class="image-wrapper three-columns">
    <div class="image-container">
        <img src="/images/KNN_/set_new.png" alt=" superposition.png">
        <img src="/images/KNN_/set_new_far_trace.png" alt="movement more.png">
	<img src="/images/KNN_/set_new_far_trace1.png" alt="added_between.png">
    </div>
    <figcaption class="image-caption"> Fig 1: a) Superimposed particle images from snapshots taken quickly, b) Superimposed particle images from snapshots taken with significant delay, c) Superimposed particle images from snapshots from (b) but with an intermdiate snap added between them</figcaption>
</figure>

<p style="text-align:justify;">
To understand this let's look at fig 1 which shows the superposition of two consecutive images of the particle. One can notice three interesting things 
</p>
<ol>
	<li> Between two successive snapshots, each particle has drifts by a distance which corresponds to its speed at that instant.If the snaps are taken in quick succession, you can identify the image pairs for each particle by eye between the snaps.(see fig 1(a))
	<li> If the particle has travelled too far,(when there is siginifant time delay in taking a snapshot) the particles position in the previous frame becomes difficult to trace by eye.(see fig 1(b))
	<li> However, if we add an intermediate snapshot, it become fairly easier to trace.(see fig 1(c)) 
</ol>
	
<! ..... Figure 2 ........>
<figure class="image-wrapper single-image">
	<div class="image-container">
		<img src ="/images/KNN_/set_new__arrow.png" class="center" >
	</div>
	<figcaption class="image-caption">Fig 2: Computing the distances of particle's image from preceding snap with all particle images from the succeeding snap (yellow arrows) the image of itself will be the shortest distance (blue arrow).</figcaption>
</figure>
	
<! ........ Figure 3 ...... >
<figure class="image-wrapper two-columns">
	<div class="image-container">
		<img src="/images/KNN_/Plain.png" alt="snap.png">
		<img src="/images/KNN_/Identify.png" alt="snap_indentification.png">
	</div>
	<figcaption class="image-caption"> Fig 3: a) Snapshot of a binary population of colloids. Those appearing white are the fluorescent particles which are 10 microns in size while the darker ones are non-fluorescent and are 7 microns in size, b) Using ImageJ we can identify the two populations quite accurately. The Fluorescent and the Non-fluorescent population are marked as <span style='color: #0000FF'>Blue</span> and <span style = 'color:#FF0000'>Red</span> points respectively in the overlay.</figcaption>
</figure>


<!......... Figure 4 ...... >
<figure class="image-wrapper two-columns">
	<div class="image-container">
		<img src="/images/KNN_/Shift.png" alt="superimposed_succesive_snaps.png">
		<img src="/images/KNN_/Shift_appriciate.png" alt="Zoomed_superimposition.png">
	</div>
	<figcaption class="image-caption"> Fig 4: a) The superimposed coordinated of the binary population from two successive snapshot. The snapshots have been taken very rapidly so the images of a single particle are almost overlapping. Just for perspective, The particle are travelling at c.a. 1 mm/s and the frames rate for imaging is 500 frames/sec b) The zoomed image of the lower left quadrant of the plot on the left. One can figure out the image pairs of most particles by eye.</figcaption>
</figure> 
<p style="text-align:justify;">


<! ........ Figure 5 ...... >
<figure class="image-wrapper single-image">
	<div class="image-container">
		<img src ="/images/KNN_/PTV_final.png" class="center" >
	</div>
	<figcaption class="image-caption">Fig 5: Using KNN (K=1) approach, image pairs of every particle is matched. The displacement between two successive snapshots of each particle between frames can now be measured now(indicated by the arrows) which also denote their respective velocity vectors </figcaption>
</figure>

	
		
	
<! --------------------- Video code block -------width = '500' height = '500'------------------>
		
    <video class="video-container"  controls>
        <source src="/images/KNN_/BinaryDemixing_final.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>



</body>
